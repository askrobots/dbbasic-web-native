<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context-Aware Semantic Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --critical: #ff3b30;
            --high: #ff9500;
            --medium: #007aff;
            --low: #8e8e93;
            --success: #34c759;

            --bg: #000000;
            --surface: #1c1c1e;
            --surface-elevated: #2c2c2e;
            --surface-modal: #3a3a3c;
            --text: #ffffff;
            --text-secondary: #98989d;
            --border: #38383a;

            --spacing: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
            overflow-x: hidden;
        }

        /* Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            height: 100vh;
            gap: 0;
        }

        /* Left Panel - Context Controls */
        .context-panel {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: calc(var(--spacing) * 1.5);
            overflow-y: auto;
        }

        .context-section {
            margin-bottom: calc(var(--spacing) * 2);
        }

        .context-section h3 {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing);
            font-weight: 600;
        }

        .context-option {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing) / 2);
            padding: calc(var(--spacing) / 2) 0;
        }

        .context-option label {
            flex: 1;
            font-size: 14px;
        }

        .toggle {
            width: 44px;
            height: 26px;
            background: var(--border);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--success);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 11px;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .toggle.active::after {
            transform: translateX(18px);
        }

        .slider-control {
            width: 100%;
        }

        .slider-control input {
            width: 100%;
            margin-top: calc(var(--spacing) / 2);
        }

        .slider-value {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .mode-select {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing) / 2);
        }

        .mode-btn {
            padding: calc(var(--spacing) / 2) var(--spacing);
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            text-align: left;
        }

        .mode-btn.active {
            background: var(--medium);
            border-color: var(--medium);
            font-weight: 600;
        }

        /* Center Panel - Main Interface */
        .main-interface {
            background: var(--bg);
            padding: calc(var(--spacing) * 2);
            overflow-y: auto;
            position: relative;
        }

        /* Multi-viewer overlay */
        .viewer-overlay {
            position: fixed;
            top: 0;
            left: 300px;
            right: 350px;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            flex-direction: column;
            gap: calc(var(--spacing) * 2);
        }

        .viewer-overlay.active {
            display: flex;
        }

        .viewer-icons {
            display: flex;
            gap: calc(var(--spacing) * 2);
            font-size: 64px;
            opacity: 0.5;
        }

        .viewer-message {
            font-size: 32px;
            text-align: center;
            max-width: 600px;
        }

        /* Voice mode overlay */
        .voice-overlay {
            position: fixed;
            bottom: calc(var(--spacing) * 2);
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface-modal);
            border: 2px solid var(--medium);
            border-radius: 16px;
            padding: calc(var(--spacing) * 1.5);
            min-width: 500px;
            display: none;
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
            z-index: 50;
        }

        .voice-overlay.active {
            display: block;
        }

        .voice-output {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: var(--spacing);
        }

        .voice-hints {
            font-size: 12px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            padding-top: var(--spacing);
        }

        /* Component Cards */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: calc(var(--spacing) * 1.5);
            margin-bottom: calc(var(--spacing) * 2);
        }

        .component {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: calc(var(--spacing) * 1.5);
            position: relative;
            opacity: 1;
            transition: all 0.3s;
        }

        .component.deferred {
            opacity: 0.3;
            transform: scale(0.95);
        }

        .component.hidden {
            display: none;
        }

        .urgency-badge {
            position: absolute;
            top: calc(var(--spacing) / 2);
            right: calc(var(--spacing) / 2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .urgency-critical { background: var(--critical); color: white; }
        .urgency-high { background: var(--high); color: white; }
        .urgency-medium { background: var(--medium); color: white; }
        .urgency-low { background: var(--low); color: white; }

        .component-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: calc(var(--spacing) / 2);
            padding-right: 60px;
        }

        .component-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing);
        }

        .component-context {
            font-size: 12px;
            font-family: 'Monaco', monospace;
            color: var(--success);
            background: rgba(52, 199, 89, 0.1);
            padding: calc(var(--spacing) / 2);
            border-radius: 4px;
            margin-top: var(--spacing);
            white-space: pre-wrap;
        }

        .attention-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--spacing);
            padding-top: var(--spacing);
            border-top: 1px solid var(--border);
            font-size: 12px;
        }

        .score-value {
            font-weight: 700;
            font-size: 16px;
        }

        .component-status {
            margin-top: var(--spacing);
            padding: calc(var(--spacing) / 2);
            background: var(--surface-elevated);
            border-radius: 6px;
            font-size: 11px;
            text-align: center;
        }

        .status-allocated { color: var(--success); }
        .status-deferred { color: var(--orange); }
        .status-hidden { color: var(--text-secondary); }

        /* Right Panel - Priority Queue */
        .priority-panel {
            background: var(--surface);
            border-left: 1px solid var(--border);
            padding: calc(var(--spacing) * 1.5);
            overflow-y: auto;
        }

        .priority-panel h2 {
            font-size: 16px;
            margin-bottom: var(--spacing);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .resource-meters {
            margin-bottom: calc(var(--spacing) * 2);
        }

        .meter {
            margin-bottom: var(--spacing);
        }

        .meter-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .meter-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--medium));
            transition: width 0.3s;
        }

        .priority-queue {
            display: flex;
            flex-direction: column;
            gap: calc(var(--spacing) / 2);
        }

        .queue-item {
            background: var(--surface-elevated);
            border-left: 4px solid;
            padding: calc(var(--spacing) / 2) var(--spacing);
            border-radius: 4px;
            font-size: 13px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
        }

        .queue-item.critical { border-color: var(--critical); }
        .queue-item.high { border-color: var(--high); }
        .queue-item.medium { border-color: var(--medium); }
        .queue-item.low { border-color: var(--low); }

        .queue-item-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .queue-item-meta {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: calc(var(--spacing) * 1.5);
            padding-bottom: var(--spacing);
            border-bottom: 1px solid var(--border);
        }

        /* Environmental indicators */
        .env-indicators {
            display: flex;
            gap: var(--spacing);
            margin-bottom: calc(var(--spacing) * 2);
            flex-wrap: wrap;
        }

        .env-indicator {
            display: flex;
            align-items: center;
            gap: calc(var(--spacing) / 2);
            padding: calc(var(--spacing) / 2) var(--spacing);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .env-indicator.active {
            border-color: var(--medium);
            background: rgba(0, 122, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Left Panel: Context Controls -->
        <div class="context-panel">
            <div class="context-section">
                <h3>Input Modality</h3>
                <div class="mode-select">
                    <button class="mode-btn active" data-mode="screen">üñ•Ô∏è Screen Only</button>
                    <button class="mode-btn" data-mode="voice-screen">üé§üì± Voice + Screen</button>
                    <button class="mode-btn" data-mode="voice-only">üé§ Voice Only</button>
                    <button class="mode-btn" data-mode="touch">üëÜ Touch</button>
                </div>
            </div>

            <div class="context-section">
                <h3>Environment</h3>
                <div class="context-option">
                    <label>Multi-Viewer Mode</label>
                    <div class="toggle" data-context="multi-viewer"></div>
                </div>
                <div class="context-option">
                    <label>Public Display</label>
                    <div class="toggle" data-context="public"></div>
                </div>
            </div>

            <div class="context-section">
                <h3>Ambient Noise</h3>
                <div class="slider-control">
                    <input type="range" min="0" max="100" value="20" id="noise-level">
                    <div class="slider-value">
                        <span>Quiet</span>
                        <span id="noise-value">20%</span>
                        <span>Loud</span>
                    </div>
                </div>
            </div>

            <div class="context-section">
                <h3>Number of Viewers</h3>
                <div class="slider-control">
                    <input type="range" min="1" max="10" value="1" id="viewer-count">
                    <div class="slider-value">
                        <span>1</span>
                        <span id="viewer-value">1 viewer</span>
                        <span>10</span>
                    </div>
                </div>
            </div>

            <div class="context-section">
                <h3>User State</h3>
                <div class="context-option">
                    <label>User Busy</label>
                    <div class="toggle" data-context="busy"></div>
                </div>
                <div class="context-option">
                    <label>Focus Mode</label>
                    <div class="toggle" data-context="focus"></div>
                </div>
            </div>

            <div class="context-section">
                <h3>Time Context</h3>
                <div class="context-option">
                    <label>After Hours</label>
                    <div class="toggle" data-context="after-hours"></div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Main Interface -->
        <div class="main-interface">
            <div class="viewer-overlay">
                <div class="viewer-icons">
                    <span>üë§</span>
                    <span>üë§</span>
                    <span>üë§</span>
                </div>
                <div class="viewer-message">
                    Multi-viewer mode active<br>
                    <span style="font-size: 18px; opacity: 0.7;">Sensitive content hidden ‚Ä¢ Privacy protected</span>
                </div>
            </div>

            <div class="voice-overlay">
                <div class="voice-output" id="voice-output">
                    Listening...
                </div>
                <div class="voice-hints" id="voice-hints">
                    Available commands will appear here
                </div>
            </div>

            <h1 class="section-title">Active Components</h1>

            <div class="env-indicators">
                <div class="env-indicator" data-indicator="modality">üñ•Ô∏è Screen</div>
                <div class="env-indicator" data-indicator="noise">üîá Quiet</div>
                <div class="env-indicator" data-indicator="viewers">üë§ Single User</div>
                <div class="env-indicator" data-indicator="state">‚úì Available</div>
            </div>

            <div class="component-grid" id="components"></div>
        </div>

        <!-- Right Panel: Priority Queue -->
        <div class="priority-panel">
            <h2>Attention Budget</h2>

            <div class="resource-meters">
                <div class="meter">
                    <div class="meter-label">
                        <span>Screen Space</span>
                        <span id="screen-usage">0%</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="screen-meter" style="width: 0%"></div>
                    </div>
                </div>

                <div class="meter">
                    <div class="meter-label">
                        <span>Audio Time</span>
                        <span id="audio-usage">0s</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="audio-meter" style="width: 0%"></div>
                    </div>
                </div>

                <div class="meter">
                    <div class="meter-label">
                        <span>Cognitive Load</span>
                        <span id="cognitive-usage">0/3</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="cognitive-meter" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <h2>Priority Queue</h2>
            <div class="priority-queue" id="priority-queue"></div>
        </div>
    </div>

    <script>
        // Component definitions with context-aware behavior
        const components = [
            {
                id: 'unsaved-changes',
                title: 'Unsaved Changes',
                description: 'Document has unsaved changes',
                urgency: 'critical',
                priority: 'user-initiated',
                attentionWeight: 100,
                canDefer: false,
                screenSpace: 20,
                audioTime: 3,
                cognitiveLoad: 1,
                contexts: {
                    'screen': 'Modal dialog with Save/Discard buttons',
                    'voice-screen': 'Say "save" or "discard"',
                    'voice-only': 'Your document has unsaved changes in 3 sections. Would you like to save, continue editing, or discard changes?',
                    'noisy': 'Visual emphasis + haptic confirmation required',
                    'multi-viewer': 'Hide document preview, show generic warning'
                }
            },
            {
                id: 'meeting-reminder',
                title: 'Meeting Starting',
                description: 'Team sync in 5 minutes',
                urgency: 'high',
                priority: 'time-sensitive',
                attentionWeight: 80,
                canDefer: false,
                screenSpace: 15,
                audioTime: 4,
                cognitiveLoad: 1,
                contexts: {
                    'screen': 'Notification banner with Join button',
                    'voice-screen': 'Meeting in 5 minutes. Say "join" when ready.',
                    'voice-only': 'Your team sync meeting starts in 5 minutes. The meeting link has been sent to your calendar. Would you like to join now?',
                    'busy': 'Defer until 2 minutes before',
                    'multi-viewer': 'Show meeting title only, hide attendees'
                }
            },
            {
                id: 'messages',
                title: 'New Messages',
                description: '3 unread from team channel',
                urgency: 'medium',
                priority: 'passive-info',
                attentionWeight: 60,
                canDefer: true,
                screenSpace: 10,
                audioTime: 5,
                cognitiveLoad: 1,
                contexts: {
                    'screen': 'Badge with count + preview',
                    'voice-screen': '3 new messages. Say "read messages" for details.',
                    'voice-only': 'You have 3 unread messages in the team channel. The most recent is from Sarah, sent 5 minutes ago: "Meeting has been moved to 3pm today." Would you like to hear the other messages?',
                    'busy': 'Defer until idle',
                    'focus': 'Collapse to badge only',
                    'multi-viewer': 'Hide content, show count only',
                    'public': 'Hide completely'
                }
            },
            {
                id: 'security-alert',
                title: 'Security Alert',
                description: 'Unusual login detected',
                urgency: 'critical',
                priority: 'system-critical',
                attentionWeight: 95,
                canDefer: false,
                screenSpace: 25,
                audioTime: 4,
                cognitiveLoad: 1,
                contexts: {
                    'screen': 'Full-screen modal with Verify/Block options',
                    'voice-screen': 'Security alert. Say "verify" if this was you, or "block" to secure account.',
                    'voice-only': 'Security alert: We detected an unusual login to your account from San Francisco, California. If this was you, say "verify". If not, say "block" to secure your account immediately.',
                    'multi-viewer': 'Generic security alert, require authentication to view details',
                    'public': 'Audio only, no screen display'
                }
            },
            {
                id: 'task-complete',
                title: 'Task Completed',
                description: 'Build finished successfully',
                urgency: 'medium',
                priority: 'user-requested',
                attentionWeight: 50,
                canDefer: true,
                screenSpace: 10,
                audioTime: 2,
                cognitiveLoad: 0.5,
                contexts: {
                    'screen': 'Success toast notification',
                    'voice-screen': 'Build complete.',
                    'voice-only': 'Your build has finished successfully. All tests passed.',
                    'busy': 'Defer until current task complete',
                    'focus': 'Silent notification'
                }
            },
            {
                id: 'update-available',
                title: 'Update Available',
                description: 'Version 2.1.0 ready to install',
                urgency: 'low',
                priority: 'promotional',
                attentionWeight: 20,
                canDefer: true,
                screenSpace: 8,
                audioTime: 3,
                cognitiveLoad: 0.5,
                contexts: {
                    'screen': 'Small banner at bottom',
                    'voice-screen': 'Update available.',
                    'voice-only': 'A software update is available. Version 2.1.0 includes performance improvements and bug fixes. Would you like to install now?',
                    'busy': 'Defer until idle',
                    'focus': 'Hide completely',
                    'after-hours': 'Auto-schedule for off-hours'
                }
            },
            {
                id: 'calendar-event',
                title: 'Calendar Event',
                description: 'Lunch with Alex at 12:30',
                urgency: 'medium',
                priority: 'time-sensitive',
                attentionWeight: 65,
                canDefer: true,
                screenSpace: 12,
                audioTime: 3,
                cognitiveLoad: 0.5,
                contexts: {
                    'screen': 'Calendar notification with location',
                    'voice-screen': 'Lunch with Alex at 12:30.',
                    'voice-only': 'You have lunch scheduled with Alex at 12:30pm at The Bistro on Main Street.',
                    'multi-viewer': 'Hide personal calendar events',
                    'public': 'Hide completely'
                }
            },
            {
                id: 'system-resources',
                title: 'Resource Warning',
                description: 'Memory usage at 85%',
                urgency: 'medium',
                priority: 'system-critical',
                attentionWeight: 55,
                canDefer: true,
                screenSpace: 10,
                audioTime: 2,
                cognitiveLoad: 0.5,
                contexts: {
                    'screen': 'System indicator with details',
                    'voice-screen': 'Memory usage high.',
                    'voice-only': 'System resources warning: Memory usage is at 85 percent. Consider closing unused applications.',
                    'busy': 'Defer unless critical',
                    'focus': 'Collapse to icon'
                }
            }
        ];

        // State
        let context = {
            mode: 'screen',
            'multi-viewer': false,
            'public': false,
            'busy': false,
            'focus': false,
            'after-hours': false,
            noiseLevel: 20,
            viewerCount: 1
        };

        const MAX_SCREEN_SPACE = 100;
        const MAX_AUDIO_TIME = 10; // seconds
        const MAX_COGNITIVE = 3;

        // Calculate attention score
        function calculateScore(component) {
            let score = component.attentionWeight;

            // Urgency multipliers
            const urgencyMultiplier = {
                'critical': 2.0,
                'high': 1.5,
                'medium': 1.0,
                'low': 0.5
            };
            score *= urgencyMultiplier[component.urgency];

            // Context penalties
            if (context.busy && component.canDefer) score *= 0.3;
            if (context.focus && component.urgency !== 'critical') score *= 0.5;
            if (context['after-hours'] && component.priority === 'promotional') score *= 0.1;
            if (context.noiseLevel > 70 && context.mode.includes('voice')) score *= 0.7;

            return Math.round(score);
        }

        // Render components
        function render() {
            const sorted = [...components]
                .map(c => ({ ...c, score: calculateScore(c) }))
                .sort((a, b) => b.score - a.score);

            let screenUsed = 0;
            let audioUsed = 0;
            let cognitiveUsed = 0;

            const allocated = [];
            const deferred = [];

            for (const component of sorted) {
                const wouldUseScreen = screenUsed + component.screenSpace;
                const wouldUseAudio = audioUsed + component.audioTime;
                const wouldUseCognitive = cognitiveUsed + component.cognitiveLoad;

                const canAllocate =
                    wouldUseScreen <= MAX_SCREEN_SPACE &&
                    wouldUseAudio <= MAX_AUDIO_TIME &&
                    wouldUseCognitive <= MAX_COGNITIVE;

                if (canAllocate && component.score > 10) {
                    allocated.push({ ...component, status: 'allocated' });
                    screenUsed = wouldUseScreen;
                    audioUsed = wouldUseAudio;
                    cognitiveUsed = wouldUseCognitive;
                } else {
                    deferred.push({ ...component, status: 'deferred' });
                }
            }

            // Check for hiding conditions
            const shouldHide = (component) => {
                if (context['multi-viewer'] && component.contexts['multi-viewer']?.includes('Hide')) return true;
                if (context['public'] && component.contexts['public']?.includes('Hide')) return true;
                if (context.focus && component.contexts['focus']?.includes('Hide')) return true;
                return false;
            };

            // Render components
            const grid = document.getElementById('components');
            grid.innerHTML = [...allocated, ...deferred].map(c => {
                const hidden = shouldHide(c);
                const contextKey = Object.keys(c.contexts).find(k => {
                    if (k === context.mode) return true;
                    if (k === 'noisy' && context.noiseLevel > 60) return true;
                    if (k === 'multi-viewer' && context['multi-viewer']) return true;
                    if (k === 'busy' && context.busy) return true;
                    if (k === 'focus' && context.focus) return true;
                    if (k === 'public' && context.public) return true;
                    if (k === 'after-hours' && context['after-hours']) return true;
                    return false;
                }) || context.mode;

                const contextOutput = c.contexts[contextKey] || c.contexts['screen'];

                return `
                    <div class="component ${c.status === 'deferred' ? 'deferred' : ''} ${hidden ? 'hidden' : ''}">
                        <div class="urgency-badge urgency-${c.urgency}">${c.urgency}</div>
                        <div class="component-title">${c.title}</div>
                        <div class="component-description">${c.description}</div>
                        <div class="component-context">${contextOutput}</div>
                        <div class="attention-score">
                            <span>Attention Score:</span>
                            <span class="score-value">${c.score}</span>
                        </div>
                        <div class="component-status status-${c.status}">
                            ${c.status === 'allocated' ? '‚úì ALLOCATED' : '‚è∏ DEFERRED'}
                            ${hidden ? '(HIDDEN)' : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Update meters
            document.getElementById('screen-meter').style.width = (screenUsed / MAX_SCREEN_SPACE * 100) + '%';
            document.getElementById('screen-usage').textContent = Math.round(screenUsed) + '%';

            document.getElementById('audio-meter').style.width = (audioUsed / MAX_AUDIO_TIME * 100) + '%';
            document.getElementById('audio-usage').textContent = audioUsed + 's';

            document.getElementById('cognitive-meter').style.width = (cognitiveUsed / MAX_COGNITIVE * 100) + '%';
            document.getElementById('cognitive-usage').textContent = cognitiveUsed.toFixed(1) + '/3';

            // Update priority queue
            const queue = document.getElementById('priority-queue');
            queue.innerHTML = [...allocated, ...deferred].map((c, i) => `
                <div class="queue-item ${c.urgency}">
                    <div class="queue-item-title">${i + 1}. ${c.title}</div>
                    <div class="queue-item-meta">
                        Score: ${c.score} | ${c.status.toUpperCase()} | ${c.priority}
                    </div>
                </div>
            `).join('');

            // Update voice overlay
            if (context.mode.includes('voice')) {
                const voiceOverlay = document.querySelector('.voice-overlay');
                voiceOverlay.classList.add('active');

                const topComponents = allocated.slice(0, 3);
                const output = topComponents.map(c => {
                    const contextKey = context.mode === 'voice-only' ? 'voice-only' : 'voice-screen';
                    return c.contexts[contextKey] || c.contexts['voice-screen'];
                }).join('\n\n');

                document.getElementById('voice-output').textContent = output || 'No urgent items.';
                document.getElementById('voice-hints').textContent =
                    context.mode === 'voice-only'
                    ? 'Commands: save, discard, join, read messages, verify, block'
                    : 'Available on screen ‚Üë or say command';
            } else {
                document.querySelector('.voice-overlay').classList.remove('active');
            }

            // Update multi-viewer overlay
            if (context['multi-viewer'] || context.viewerCount > 1) {
                document.querySelector('.viewer-overlay').classList.add('active');
            } else {
                document.querySelector('.viewer-overlay').classList.remove('active');
            }

            // Update env indicators
            const indicators = {
                modality: {
                    'screen': 'üñ•Ô∏è Screen',
                    'voice-screen': 'üé§üì± Voice + Screen',
                    'voice-only': 'üé§ Voice Only',
                    'touch': 'üëÜ Touch'
                }[context.mode],
                noise: context.noiseLevel < 30 ? 'üîá Quiet' : context.noiseLevel < 70 ? 'üîâ Moderate' : 'üîä Loud',
                viewers: context.viewerCount === 1 ? 'üë§ Single User' : `üë• ${context.viewerCount} Viewers`,
                state: context.busy ? '‚è≥ Busy' : context.focus ? 'üéØ Focus' : '‚úì Available'
            };

            document.querySelectorAll('.env-indicator').forEach(el => {
                const type = el.dataset.indicator;
                el.textContent = indicators[type];
                el.classList.toggle('active',
                    type === 'noise' && context.noiseLevel > 60 ||
                    type === 'viewers' && context.viewerCount > 1 ||
                    type === 'state' && (context.busy || context.focus)
                );
            });
        }

        // Event listeners
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                context.mode = btn.dataset.mode;
                render();
            });
        });

        document.querySelectorAll('.toggle').forEach(toggle => {
            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                context[toggle.dataset.context] = toggle.classList.contains('active');
                render();
            });
        });

        document.getElementById('noise-level').addEventListener('input', (e) => {
            context.noiseLevel = parseInt(e.target.value);
            document.getElementById('noise-value').textContent = context.noiseLevel + '%';
            render();
        });

        document.getElementById('viewer-count').addEventListener('input', (e) => {
            context.viewerCount = parseInt(e.target.value);
            document.getElementById('viewer-value').textContent =
                context.viewerCount === 1 ? '1 viewer' : context.viewerCount + ' viewers';
            render();
        });

        // Initial render
        render();
    </script>
</body>
</html>
